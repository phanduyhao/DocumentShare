@extends('layout.layout')
@section('content')
    <div class="main mt-5">
        <div class="container">
            <div class="content-url d-flex align-items-center mb-4">
                <img src="https://hocmai.vn/theme/new2/images/home-1-icon.png" alt="" class="me-1">
                <a href="/" class="me-1">Trang chủ</a>
                &gt;
                <a href="#" class="ms-1 me-1">Danh sách tài liệu</a>
                &gt;
                <a href="#" class="ms-1 me-1">Lớp 10</a>
                &gt;
                <a href="#" class="ms-1 me-1">Hoá học</a>
            </div>
        </div>
        <div class="content">
            <div class="container">
                <div class="row">
                    <div class="col col-3">
                        <div class="lib-sidebar">
                            <h4 class="lib-header mb-0">Danh mục tài liệu</h4>
                            <ul class="lib-sidebar-list">
                                <li class="lib-sidebar-item-main">
                                    <a href="#">Đại học - Cao đẳng</a>
                                </li>
                                <li class="lib-sidebar-item d-flex align-items-center position-relative">
                                    <a href="#">Toán cao cấp</a>
                                    <i class="ti-angle-right position-absolute top-50 end-0 translate-middle-y pe-3"></i>
                                    <ul class="lib-sidebar-sublist position-absolute top-0 start-100">
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Đại số tuyến tính</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Giải tích 1</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Giải tích 2</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="lib-sidebar-item">
                                    <a href="#">Pháp luật đại cương</a>
                                </li>
                                <li class="lib-sidebar-item-main">
                                    <a href="#">Trung học phổ thông</a>
                                </li>
                                <li class="lib-sidebar-item d-flex align-items-center position-relative">
                                    <a href="#">Lớp 12</a>
                                    <i class="ti-angle-right position-absolute top-50 end-0 translate-middle-y pe-3"></i>
                                    <ul class="lib-sidebar-sublist position-absolute top-0 start-100">
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Toán</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Ngữ Văn</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Tiếng Anh</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="lib-sidebar-item d-flex align-items-center position-relative">
                                    <a href="#">Lớp 11</a>
                                    <i class="ti-angle-right position-absolute top-50 end-0 translate-middle-y pe-3"></i>
                                    <ul class="lib-sidebar-sublist position-absolute top-0 start-100">
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Toán</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Ngữ Văn</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Tiếng Anh</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="lib-sidebar-item d-flex align-items-center position-relative">
                                    <a href="#">Lớp 10</a>
                                    <i class="ti-angle-right position-absolute top-50 end-0 translate-middle-y pe-3"></i>
                                    <ul class="lib-sidebar-sublist position-absolute top-0 start-100">
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Toán</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Ngữ Văn</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Tiếng Anh</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="lib-sidebar-item-main">
                                    <a href="#">Trung học cơ sở</a>
                                </li>
                                <li class="lib-sidebar-item d-flex align-items-center position-relative">
                                    <a href="#">Lớp 9</a>
                                    <i class="ti-angle-right position-absolute top-50 end-0 translate-middle-y pe-3"></i>
                                    <ul class="lib-sidebar-sublist position-absolute top-0 start-100">
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Toán</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Ngữ Văn</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Tiếng Anh</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="lib-sidebar-item d-flex align-items-center position-relative">
                                    <a href="#">Lớp 8</a>
                                    <i class="ti-angle-right position-absolute top-50 end-0 translate-middle-y pe-3"></i>
                                    <ul class="lib-sidebar-sublist position-absolute top-0 start-100">
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Toán</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Ngữ Văn</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Tiếng Anh</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="lib-sidebar-item d-flex align-items-center position-relative">
                                    <a href="#">Lớp 7</a>
                                    <i class="ti-angle-right position-absolute top-50 end-0 translate-middle-y pe-3"></i>
                                    <ul class="lib-sidebar-sublist position-absolute top-0 start-100">
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Toán</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Ngữ Văn</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Tiếng Anh</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="lib-sidebar-item d-flex align-items-center position-relative">
                                    <a href="#">Lớp 6</a>
                                    <i class="ti-angle-right position-absolute top-50 end-0 translate-middle-y pe-3"></i>
                                    <ul class="lib-sidebar-sublist position-absolute top-0 start-100">
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Toán</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Ngữ Văn</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Tiếng Anh</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="lib-sidebar-item-main">
                                    <a href="#">Tiểu học</a>
                                </li>
                                <li class="lib-sidebar-item d-flex align-items-center position-relative">
                                    <a href="#">Lớp 5</a>
                                    <i class="ti-angle-right position-absolute top-50 end-0 translate-middle-y pe-3"></i>
                                    <ul class="lib-sidebar-sublist position-absolute top-0 start-100">
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Toán</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Tiếng Việt</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Tiếng Anh</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="lib-sidebar-item d-flex align-items-center position-relative">
                                    <a href="#">Lớp 4</a>
                                    <i class="ti-angle-right position-absolute top-50 end-0 translate-middle-y pe-3"></i>
                                    <ul class="lib-sidebar-sublist position-absolute top-0 start-100">
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Toán</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Tiếng Việt</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Tiếng Anh</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="lib-sidebar-item d-flex align-items-center position-relative">
                                    <a href="#">Lớp 3</a>
                                    <i class="ti-angle-right position-absolute top-50 end-0 translate-middle-y pe-3"></i>
                                    <ul class="lib-sidebar-sublist position-absolute top-0 start-100">
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Toán</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Tiếng Việt</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Tiếng Anh</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="lib-sidebar-item d-flex align-items-center position-relative">
                                    <a href="#">Lớp 2</a>
                                    <i class="ti-angle-right position-absolute top-50 end-0 translate-middle-y pe-3"></i>
                                    <ul class="lib-sidebar-sublist position-absolute top-0 start-100">
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Toán</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Tiếng Việt</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Tiếng Anh</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="lib-sidebar-item d-flex align-items-center position-relative">
                                    <a href="#">Lớp 1</a>
                                    <i class="ti-angle-right position-absolute top-50 end-0 translate-middle-y pe-3"></i>
                                    <ul class="lib-sidebar-sublist position-absolute top-0 start-100">
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Toán</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Tiếng Việt</a>
                                        </li>
                                        <li class="lib-sidebar-subitem">
                                            <i class="fa-solid fa-calculator me-2"></i>
                                            <a href="" class="">Tiếng Anh</a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div class="lib-sidebar mt-4">
                            <h4 class="lib-header mb-0">Từ khoá liên quan</h4>
                            <div class="keywords-lists d-flex flex-fill flex-wrap p-2">
                                <div class="keywords-item m-1">
                                    <a href="">bài tập hoá</a>
                                </div>
                                <div class="keywords-item m-1">
                                    <a href="">công thức hoá</a>
                                </div>
                                <div class="keywords-item m-1">
                                    <a href="">bài tập hoá 10-có lời giải</a>
                                </div>
                                <div class="keywords-item m-1">
                                    <a href="">đề thi</a>
                                </div>
                                <div class="keywords-item m-1">
                                    <a href="">đề thi hsg hoá </a>
                                </div>
                            </div>
                        </div>

                        <div class="lib-sidebar mt-4">
                            <h4 class="lib-header mb-0">Tài liệu liên quan</h4>
                            <div class="related-document">
                                <div class="related-document-item d-flex align-items-center py-2 px-3">
                                    <i class="fa-regular fa-file-pdf fs-3 me-2"></i>
                                    <a href="" class="lh-1">Đề thi trung học phổ thông môn hoá 2022 </a>
                                </div>
                                <div class="related-document-item d-flex align-items-center py-2 px-3">
                                    <i class="fa-regular fa-file-word fs-3 me-2"></i>
                                    <a href="" class="lh-1">Đề thi trung học phổ thông môn hoá 2022 </a>
                                </div>
                                <div class="related-document-item d-flex align-items-center py-2 px-3">
                                    <i class="fa-regular fa-file-video fs-3 me-2"></i>
                                    <a href="" class="lh-1">Đề thi trung học phổ thông môn hoá 2022 </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col col-9">
                        <div class="list-document mb-3">
                            <div class="content-titel  mx-2">
                                <h4 class="m-0">{{$document->title}}</h4>
                                <div class="parameter-docunment d-flex justify-content-between align-items-center">
                                    <div class="parameter-docunment-item ">
                                        <div class="parameter d-flex align-items-center">
                                            <i class="ti-eye me-1"></i>
                                            <span class="me-1">Lượt xem:</span>
                                            <span>{{ $document->views_count }}</span>
                                        </div>
                                        <div class="parameter d-flex align-items-center">
                                            <i class="fa-solid fa-user me-1"></i>
                                            <span class="me-1">Tác giả:</span>
                                            <span>{{$document->User->name}}</span>
                                        </div>
                                    </div>
                                    <div class="parameter-docunment-item  ">
                                        <div class="parameter d-flex align-items-center">
                                            <i class="fa-solid fa-download pe-1"></i>
                                            <span class="me-1">Lượt tải:</span>
                                            <span>{{ $document->downloads_count }}</span>
                                        </div>
                                        <div class="parameter d-flex align-items-center">
                                            <i class="fa-solid fa-coins pe-1"></i>
                                            <span class="me-1">Số điểm:</span>
                                            <span class="ms-1">{{$document->score}}</span>
                                        </div>
                                    </div>
                                    <div class="parameter-docunment-item ">
                                        @if($document->type == 'pdf')
                                            <a data-id="{{$document->id}}" data-score-doc="{{$document->score}}" data-score-user="{{ Auth::user()->score }}" data-user-id="{{ Auth::id() }}" href="/temp/files/{{$document->file}}" download class="btn btn-success text-white download-file btn-download px-3">
                                                <i class="fa-solid fa-download pe-1"></i>
                                                <span>Tải xuống</span>
                                            </a>
                                        @else
                                            <a data-id="{{$document->id}}" data-score-doc="{{$document->score}}" data-score-user="{{ Auth::user()->score }}" data-user-id="{{ Auth::id() }}" href="/temp/filesOrigin/{{$document->file}}.{{$document->type}}" download class="btn btn-success text-white download-file btn-download px-3">
                                                <i class="fa-solid fa-download pe-1"></i>
                                                <span>Tải File gốc ({{$document->type}})</span>
                                            </a>
                                            <a data-id="{{$document->id}}" data-score-doc="{{$document->score}}" data-score-user="{{ Auth::user()->score }}" data-user-id="{{ Auth::id() }}" href="/temp/files/{{$document->file}}" download class="btn btn-success text-white download-file btn-download px-3">
                                                <i class="fa-solid fa-download pe-1"></i>
                                                <span>Tải File PDF</span>
                                            </a>
                                        @endif
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content-document ps-3">
                            <iframe src="/temp/files/{{$document->file }}" width="700" height="720" allow="autoplay"></iframe>
                        </div>

                        <div class="list-document mt-5">
                            <div class="content-titel d-flex justify-content-between mx-2">
                                <h4>Bình luận</h4>
                                <span>
                                {{$document->comments_count}} <span>bình luận</span>
                              </span>
                            </div>





                            <div class="comment container-width" id="comment_area">
                                <!-- TEST -->
                                <form id="boxCommentForm" class="comment-box" data-action="{{route('sendComment')}}">
                                    @csrf
                                    <input type="hidden" name="document" value="{{ $document->id }}"> <!-- Đặt parent_comment_id -->
                                    <div class="d-flex">
                                        <div class="comment-avata d-flex align-items-center justify-content-center me-2">
                                            @if($document->User->avatar == null)
                                                <i class="fa-solid fa-user"></i>
                                            @else
                                                <img width="50" class="rounded-circle" src="/temp/images/avatars/{{$document->User->avatar}}" alt="Avatar">
                                            @endif
                                        </div>
                                        <div class="form-comment w-100">
                                            <textarea name="comment" class="input-field textarea-note p-3 w-100" id="" rows="3" placeholder="Nhập bình luận *" data-require="Vui lòng nhập nội dung!"></textarea>
                                        </div>
                                    </div>
                                    <button type="submit" class="send-comment float-end btn btn-primary">Gửi bình luận</button>
                                </form>

                                <div class="comment-list mt-5">
                                    @foreach($comments->sortByDesc('created_at') as $comment)
                                        @if($comment->parent_comment_id == null)
                                            <div class="comment-user ">
                                                <p class="id_user d-none" >{{ $comment->id }}</p>

                                                <div class="comments-users d-flex mb-4">
                                                    <div class="comment-avata d-flex align-items-center justify-content-center me-3">
                                                        @if($comment->User->avatar == null)
                                                            <i class="fa-solid fa-user"></i>
                                                        @else
                                                            <img width="50" class="rounded-circle" src="/temp/images/avatars/{{$comment->User->avatar}}" alt="Avatar">
                                                        @endif
                                                    </div>
                                                    <div class="comment-user-info ">
                                                        <div class="comment-user-info-item">
                                                            <a href="">{{$comment->User->name}}</a>
                                                        </div>
                                                        <div class="comment-user-info-item">
                                                            <i class="fa-solid fa-calendar-days "></i>
                                                            <span >{{$comment->created_at}}</span>
                                                        </div>
                                                        <div class="comment-user-info-item">
                                                            <p class="comment-user-desc m-0 mt-3">
                                                                {{$comment->comment}}
                                                            </p>
                                                        </div>




                                                        <div class="reply">
                                                            <p class="reply-text  mt-2">
                                                                <a class="reply-text__link fw-bold text-info" href="">
                                                                    Trả lời
                                                                    <span class="id_user d-none" >{{ $comment->id }}</span>
                                                                </a>
                                                            </p>
                                                            <!-- TEST -->
                                                            <form id="boxCommentFormReply_{{ $comment->id }}" class="comment-box child d-none bg-white p-3" data-action="{{route('sendComment')}}" >
                                                                <p id="{{ $comment->id }}" class="boxCommentFormReplyID d-none"></p>
                                                                @csrf
                                                                <input type="hidden" name="document" value="{{ $document->id }}"> <!-- Đặt parent_comment_id -->
                                                                <input type="hidden" name="parent_comment_id" value="{{ $comment->id }}"> <!-- Đặt parent_comment_id -->
                                                                <div class="d-flex">
                                                                    <div class="comment-avata d-flex align-items-center justify-content-center me-2">
                                                                        @if($document->User->avatar == null)
                                                                            <i class="fa-solid fa-user"></i>
                                                                        @else
                                                                            <img width="50" class="rounded-circle" src="/temp/images/avatars/{{$document->User->avatar}}" alt="Avatar">
                                                                        @endif
                                                                    </div>
                                                                    <div class="form-comment w-100">
                                                                        <textarea name="comment" class="input-field textarea-note w-100 p-3" id="" rows="3" placeholder="Nhập bình luận *" data-require="Vui lòng nhập nội dung!"></textarea>
                                                                    </div>
                                                                </div>
                                                                <button type="submit" class="send-comment float-end btn btn-primary">Gửi bình luận</button>
                                                            </form>
                                                            <!-- TEST -->
                                                        @if($comment->hasChildren()) <!-- Kiểm tra nếu có comment con -->
                                                            <div class="reply-box bg-white p-3">
                                                                @php
                                                                    $comment_childs = $comments;
                                                                @endphp
                                                                <div class="comment-list__child-{{ $comment->id }}">
                                                                    @foreach($comment_childs->sortByDesc('created_at') as $comment_child)
                                                                        @if($comment_child->parent_comment_id == $comment->id)
                                                                            <div class="d-flex mb-4">
                                                                                <div class="comment-avata d-flex align-items-center justify-content-center me-3">
                                                                                    @if($comment_child->User->avatar == null)
                                                                                        <i class="fa-solid fa-user"></i>
                                                                                    @else
                                                                                        <img width="50" class="rounded-circle" src="/temp/images/avatars/{{$comment_child->User->avatar}}" alt="Avatar">
                                                                                    @endif
                                                                                </div>
                                                                                <div class="comment-user-info ">
                                                                                    <div class="comment-user-info-item">
                                                                                        <a href="">{{$comment_child->User->name}}</a>
                                                                                    </div>
                                                                                    <div class="comment-user-info-item">
                                                                                        <i class="fa-solid fa-calendar-days "></i>
                                                                                        <span >{{$comment_child->created_at}}</span>
                                                                                    </div>
                                                                                    <div class="comment-user-info-item">
                                                                                        <p class="comment-user-desc m-0 mt-3">
                                                                                            {{$comment_child->comment}}
                                                                                        </p>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        @endif
                                                                    @endforeach
                                                                </div>
                                                            </div>
                                                            @endif
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    @endforeach
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
@endsection
