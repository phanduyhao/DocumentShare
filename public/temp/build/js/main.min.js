$(document).ready(function(){let t=$(".main-slide .slick-current.slick-active img").attr("src");$(".main-bg img").attr("src",t),$(".download-file").click(function(t){let e=$(this).data("id"),s=$(this).data("user-id"),a=$(this).data("score-user"),r=$(this).data("score-doc");if(a>r||a==r){let t=a-r;$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/download",data:{document_id:e,user_id:s},success:function(e){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/update-score",data:{user_score:t},success:function(){toastr.success("Tải xuống thành công!","Thông báo")},error:function(){alert("Lỗi cập nhật điểm!")}})},error:function(){alert("Lỗi tải xuống!")}})}else t.preventDefault(),toastr.error("Không đủ điểm!","Thông báo")}),$(".btn-show__details-file").click(function(){let t=$(this).data("id"),e=$(this).data("user-id");$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/view",data:{document_id:t,user_id:e},error:function(){alert("Lỗi!")}})}),$(".btn-favourite").click(function(t){t.preventDefault();let e=$(this).data("id"),s=$(this).data("user-id");var a=$(this).find("i.icon-favourite");a.hasClass("text-danger")?(a.removeClass("text-danger"),$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/unfavourite",data:{document_id:e,user_id:s},success:function(t){t.success&&toastr.success(t.message,"Thông báo")},error:function(){alert("Lỗi!")}})):(a.addClass("text-danger"),$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/favourite",data:{document_id:e,user_id:s},success:function(t){t.success&&toastr.success(t.message,"Thông báo")},error:function(){alert("Lỗi!")}}))});let e=!1;$(".star").click(function(){const t=20*($(this).index()+1);$(".filled-stars").css("width",t+"%"),e=!0}),$(".btn-rate").click(function(){if(e){let e=$(this).data("doc-id"),s=$(this).data("user-id"),a=$(".filled-stars").attr("style").split(":")[1].trim();var t=parseInt(a,10);$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/rate",data:{document_id:e,user_id:s,rate:t},success:function(t){$(".filled-stars").css("width","0%"),t.success&&toastr.success(t.message,"Thông báo")},error:function(){toastr.error("Lỗi đánh giá!","Thông báo")}})}else toastr.error("Chưa đánh giá tài liệu!","Thông báo")});for(var s=$("#list-comment__data"),a=s.data("comment-limit"),r=s.data("load-more"),n=s.data("total-cmt"),o=$(".comment-list"),i=$("#loadMoreComments"),c=a;c<n;c++){var d=o.find('[data-comment-index="'+(c+1)+'"]');d.length&&d.hide()}i.on("click",function(){for(var t=a+r,e=a;e<t&&e<n;e++){var s=o.find('[data-comment-index="'+(e+1)+'"]');s.length&&s.show()}(a=t)>=n&&i.hide()}),$("#btn-reset_pass").on("click",function(){$("#old_pass_error, #new_pass_error, #confirm_pass_error").text("");var t=$("#old_pass").val(),e=$("#new_pass").val(),s=$("#confirm_pass").val(),a=!1;""===t&&($("#old_pass_error").text("Vui lòng nhập mật khẩu hiện tại!"),a=!0),""===e&&($("#new_pass_error").text("Vui lòng nhập mật khẩu mới!"),a=!0),""===s&&($("#confirm_pass_error").text("Vui lòng nhập lại mật khẩu mới!"),a=!0),a||$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/change-password",data:{_token:$('input[name="_token"]').val(),old_pass:t,new_pass:e,confirm_pass:s},success:function(t){t.success?(toastr.success("Đổi mật khẩu thành công!","Thông báo"),$("#old_pass, #new_pass, #confirm_pass").val("")):(t.errors.old_pass&&$("#old_pass_error").text(t.errors.old_pass),t.errors.new_pass&&$("#new_pass_error").text(t.errors.new_pass),t.errors.confirm_pass&&$("#confirm_pass_error").text(t.errors.confirm_pass))},error:function(){alert("Something went wrong with the AJAX request")}})})});