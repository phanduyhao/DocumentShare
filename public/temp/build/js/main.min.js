$(document).ready(function(){$(".docs-item__pdf").each(function(){const e=$(this).data("src"),t=$(this);pdfjsLib.getDocument(e).promise.then(function(e){e.getPage(1).then(function(e){const s=document.createElement("canvas"),n=s.getContext("2d"),r=e.getViewport({scale:1});s.height=r.height,s.width=r.width;const a={canvasContext:n,viewport:r};e.render(a),t.append(s)})})}),$(".docs-title").each(function(){var e=$(this),t=e.text();if(e.css({"max-height":"58px",overflow:"hidden","text-overflow":"ellipsis"}),e[0].scrollHeight>58||58==e[0].scrollHeight){var s=t.lastIndexOf(" ",t.length=70),n=t.substring(0,s)+"...";e.text(n)}});const e=$("#pdfContainer").data("src");let t=0,s=!1;pdfjsLib.getDocument(e).promise.then(function(e){t=e.numPages;for(let t=1;t<=e.numPages;t++)e.getPage(t).then(function(e){const t=document.createElement("canvas"),s=t.getContext("2d"),n=e.getViewport({scale:1.5});t.height=n.height,t.width=n.width;const r={canvasContext:s,viewport:n};e.render(r),$("#pdfContainer").append(t)});$("#pdfContainer").scroll(function(){($(this).scrollTop()+$(this).height())/$(this)[0].scrollHeight>=.5&&!s&&(toastr.error("Tải xuống để xem toàn bộ","Thông báo"),s=!0,$(this).addClass("overflow-hidden"),$(this).removeClass("overflow-auto"))})})}),$(document).ready(function(){let e=window.location.href,t=new URL(e).pathname.split("/").pop();$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/increase-view",data:{doc_slug:t},success:function(e){console.log(e)},error:function(e){console.log(e)}});let s=$(".main-slide .slick-current.slick-active img").attr("src");$(".main-bg img").attr("src",s),$(".download-file").click(function(e){let t=$(this).data("user-id");if(t){let s=$(this).data("id"),n=$(this).data("score-user"),r=$(this).data("score-doc"),a=$(this).data("author");if(n>r||n==r){let e=n-r;$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/download",data:{document_id:s,user_id:t},success:function(t){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/update-score",data:{user_score:e},success:function(){toastr.success("Tải xuống thành công!","Thông báo")},error:function(){alert("Lỗi cập nhật điểm!")}}),$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/plus-score",data:{author_id:a,score_doc:r},success:function(e){},error:function(){}})},error:function(){alert("Lỗi tải xuống!")}})}else e.preventDefault(),toastr.error("Không đủ điểm!","Thông báo")}else e.preventDefault(),toastr.error("Bạn chưa đăng nhập!","Thông báo")}),$(".btn-favourite").click(function(e){e.preventDefault();let t=$(this).data("user-id");if(console.log(t),t){let e=$(this).data("id");var s=$(this).find("i.icon-favourite");s.hasClass("text-danger")?(s.removeClass("text-danger"),$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/unfavourite",data:{document_id:e,user_id:t},success:function(e){e.success&&toastr.success(e.message,"Thông báo")},error:function(){toastr.error("Lỗi yêu thích!","Thông báo")}})):(s.addClass("text-danger"),$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/favourite",data:{document_id:e,user_id:t},success:function(e){e.success&&toastr.success(e.message,"Thông báo")},error:function(){alert("Lỗi!")}}))}else e.preventDefault(),toastr.error("Bạn chưa đăng nhập!","Thông báo")});let n=!1;$(".star").click(function(){const e=20*($(this).index()+1);$(".filled-stars").css("width",e+"%"),n=!0}),$(".btn-rate").click(function(){let e=$(this).data("user-id");if(e)if(n){let s=$(this).data("doc-id"),n=$(".filled-stars").attr("style").split(":")[1].trim();var t=parseInt(n,10);$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/rate",data:{document_id:s,user_id:e,rate:t},success:function(e){$(".filled-stars").css("width","0%"),e.success&&toastr.success(e.message,"Thông báo")},error:function(){toastr.error("Lỗi đánh giá!","Thông báo")}})}else toastr.error("Chưa đánh giá tài liệu!","Thông báo");else toastr.error("Bạn chưa đăng nhập!","Thông báo")}),$("#btn-reset_pass").on("click",function(){$("#old_pass_error, #new_pass_error, #confirm_pass_error").text("");var e=$("#old_pass").val(),t=$("#new_pass").val(),s=$("#confirm_pass").val(),n=!1;""===e&&($("#old_pass_error").text("Vui lòng nhập mật khẩu hiện tại!"),n=!0),""===t&&($("#new_pass_error").text("Vui lòng nhập mật khẩu mới!"),n=!0),""===s&&($("#confirm_pass_error").text("Vui lòng nhập lại mật khẩu mới!"),n=!0),n||$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/change-password",data:{_token:$('input[name="_token"]').val(),old_pass:e,new_pass:t,confirm_pass:s},success:function(e){e.success?(toastr.success("Đổi mật khẩu thành công!","Thông báo"),$("#old_pass, #new_pass, #confirm_pass").val("")):(e.errors.old_pass&&$("#old_pass_error").text(e.errors.old_pass),e.errors.new_pass&&$("#new_pass_error").text(e.errors.new_pass),e.errors.confirm_pass&&$("#confirm_pass_error").text(e.errors.confirm_pass))},error:function(){alert("Something went wrong with the AJAX request")}})}),$(document).ready(function(){function e(){var e=$("#form_document_upload .cate_select .helper"),n=$("#form_document_upload .cate_more .helper");t.val()?(s.removeClass("input-field input-error").prop("disabled",!0),n.addClass("d-none"),t.removeClass("input-field input-error"),e.addClass("d-none")):s.val()?(t.removeClass("input-field input-error").prop("disabled",!0),e.addClass("d-none"),s.removeClass("input-field input-error"),n.addClass("d-none")):(t.addClass("input-field input-error").prop("disabled",!1),s.addClass("input-field").prop("disabled",!1),n.addClass("d-none"),e.addClass("d-none"))}var t=$("#form_document_upload #cate_select"),s=$("#form_document_upload #cate_add");t.on("change",function(){e()}),s.on("input",function(){e()})}),$(".btn-send-feedback").click(function(){var e=$("#feedbackForm").serialize();$.ajax({type:"POST",url:"/send-feedback",data:e,success:function(e){console.log(e),alert("Phản hồi đã được gửi thành công!")},error:function(e){console.log(e),alert("Có lỗi xảy ra khi gửi phản hồi!")}})})});