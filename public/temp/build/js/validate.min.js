function validateForm(e){let t=!0;return $(e).find(".input-field").each(function(){let e=$(this).val(),n=$(this).attr("type");if($(this).removeClass("input-error"),"email"==n&&""!==e&&!isValidEmail(e)){t=!1,$(this).addClass("input-error");$(this).parent().append('<span class="helper text-danger" style="z-index: 999;margin-top: 75px;">Chưa nhập đúng kiểu email</span>')}if(null==e||""==e||void 0==e){let e=$(this);if(t=!1,!e.next(".helper.text-danger").length){let t=`<span class="helper text-danger" style="z-index: 999;margin-top: 75px;">${e.data("require")}</span>`;e.parent().append(t)}e.hasClass("input-error")||e.addClass("input-error")}}),t}function isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function appendNewComment(e,t){var n=$(".my-avatar").attr("src"),a=new Date,i=a.getHours(),o=a.getMinutes(),m=a.getSeconds(),s=a.getDate(),r=a.getMonth()+1,c=a.getFullYear(),d=$('<div class="comments-users d-flex mb-4"><div class="comment-avata d-flex align-items-center justify-content-center me-3"><img width="50" height="50" class="rounded-circle" src="'+n+'" alt="Avatar"></div><div class="comment-user-info "><div class="comment-user-info-item"><a href="">'+e.user_name+'</a></div><div class="comment-user-info-item"><i class="fa-solid fa-calendar-days me-1"></i><span>'+c+"-"+r+"-"+s+" "+i+":"+o+":"+m+'</span></div><div class="comment-user-info-item"><p class="comment-user-desc m-0 mt-3">'+e.comment+'</p></div><div class="reply"><form id="boxCommentFormReply_'+e.id+'" class="comment-box child d-none bg-white p-3" data-action="http://documentmanage.test/sendComment"><p id="'+e.id+'" class="boxCommentFormReplyID d-none"></p><input type="hidden" name="_token" value="jmbwntWbDWzOKRBaCsvOPJtXzjTKp4tLhDcCXkq1" autocomplete="off"><input type="hidden" name="document" value="59"><input type="hidden" name="parent_comment_id" value="'+e.id+'"><div class="d-flex"><div class="comment-avata d-flex align-items-center justify-content-center me-2"><img width="50" height="50" class="rounded-circle" src="'+n+'" alt="Avatar"></div><div class="form-comment w-100"><textarea name="comment" class="input-field textarea-note w-100 p-3" rows="3" placeholder="Nhập bình luận *" data-require="Vui lòng nhập nội dung!"></textarea></div></div><button type="submit" class="send-comment float-end btn btn-primary">Gửi bình luận</button></form></div></div></div>');$(`.${t}`).prepend(d)}$("#form-pay__money").submit(function(e){e.preventDefault(),$amount_money=$("#input-amount__money").val(),$amount_money?parseInt($amount_money)<1e4?alert("Số tiền không được nhỏ hơn 10.000đ."):$(this).submit():alert("Bạn chưa nhập số tiền.")}),$("form .input-field").each(function(){$(this).click(function(){$(this).parent().find(".helper").remove(),$(this).removeClass("input-error")})}),$("body form").on("click",function(e){e.stopPropagation()}),$('#comment_area form button[type="submit"]').on("click",function(e){e.preventDefault();let t=$(this).closest("form"),n=t.attr("id"),a=t.data("action");if(validateForm(`#${n}`)){let e=t.serialize();$.ajax({type:"POST",url:a,data:e,success:function(e){toastr.success("Đã gửi bình luận!","Thông báo"),$(`#${n} input[type=text], #${n} input[type=email], #${n} textarea`).val("");var t=$("#"+n+" .boxCommentFormReplyID ").attr("id");"boxCommentForm"===n?appendNewComment(e,"comment-list"):n==="boxCommentFormReply_"+t&&appendNewComment(e,"comment-list__child-"+t)},error:function(){toastr.error("Lỗi bình luận!","Thông báo")}})}}),$("#load-more-comments-btn").on("click",function(){var e=$(this).data("doc-id"),t=$("#list-comment__data").data("comment-limit"),n=$("#list-comment__data").data("load-more");$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/load-comments",type:"GET",data:{document_id:e,offset:t,loadMoreCommentsCount:n},success:function(e){var a=e.comments;a.length>0&&(a.forEach(function(e){var t=new Date(e.created_at).toLocaleString("en-US",{timeZone:"UTC"}),n=`\n                        <div class="comment-user" data-comment-index="${e.index}">\n                            <div class="comments-users d-flex mb-4">\n                                <div class="comment-avata d-flex align-items-center justify-content-center me-3">\n                                     <img width="50" height="50" class="rounded-circle" src="/temp/images/avatars/${e.avatar}" alt="Avatar">\n                                 </div>\n                                <div class="comment-user-info">\n                                    <div class="comment-user-info-item">\n                                        <a href="">${e.name}</a>\n                                    </div>\n                                    <div class="comment-user-info-item">\n                                        <i class="fa-solid fa-calendar-days "></i>\n                                        <span>${t}</span>\n                                    </div>\n                                    <div class="comment-user-info-item">\n                                        <p class="comment-user-desc m-0 mt-3">${e.comment}</p>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>`;if(null==e.parent_comment_id)$(".comment-list").append(n);else{$(`.comment-user[data-id="${e.parent_comment_id}"]`).find(".reply-box").append(n)}}),t+=a.length,$("#list-comment__data").data("comment-limit",t),a.length<n&&$("#load-more-comments-btn").hide())},error:function(e,t,n){console.error(n)}})}),$("body").on("click",function(e){$(".helper").remove(),$(".input-error").removeClass("input-error")}),$(".reply-text__link").on("click",function(e){e.preventDefault(),$(".comment-box.child").addClass("d-none");$(this).closest(".comment-user").find(".comment-box.child").removeClass("d-none")});